<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">

<dom-module id="suivi-element">
	<template>
		<style>
			:host {
				/*float: left;
				position: absolute;
		 		margin-top: -2%;
  				margin-left: -2%;*/
  			}
  			#suivi {
  				width:70%;
  			}
			.suiviButton {
		        color: white;
        		background: #454646;
				font-family: 'RobotoDraft', sans-serif;
				text-align: center;
			}
			.suiviButton:hover {
		        color: white;
        		background: #0AC45E;
			}
			#sendSuivi {
				padding: 10px 15px;
				position: relative;
				left: 0;
				right: 0;
				margin: auto;
			}
			.paper {
				font-size:1.3em;
			}
			.paperi {
				font-size:1.3em;
			}
			.msgError {
				font-family: 'RobotoDraft', sans-serif;
				font-size: 75%;
				margin-top: 3%;
				color: red;
			}
			#content {
				background-color: white;
				padding: 2%;
			}
			.centered {
				text-align: center;
			}
			#lastinfo {
				margin-top:5%;
			}
			#textcontent {
				width: 100%;
			}
			.container {
				@apply(--layout-horizontal);
			}
			.flex2child {
				@apply(--layout-flex-2);
			}
			.flex5child {
				@apply(--layout-flex-5);
			}
			.flex12child {
				@apply(--layout-flex-12);
			}
		</style>

		<paper-button class="suiviButton" on-click="toggleSuivi">Remplir le suivi</paper-button>
		<paper-dialog id="suivi">
			<div id="content">
				<div id="info">
					<div class="container">
						<div class="flex5child">
							<paper-input class="paperi" id="poids" type="number" label="Poids" error="Uniquement des chiffres" floatingLabel><div suffix>kg</div></paper-input>
							<p id="perr" class="msgError" hidden>poids requis</p>
						</div>
						<div class="flex2child"></div>
						<div class="flex5child">
							<paper-input class="paperi" id="taille" type="number" label="Taille" error="Uniquement des chiffres" floatingLabel><div suffix>cm</div></paper-input>
							<p id="terr" class="msgError" hidden>taille requise</p>
						</div>
					</div>
					<div class="container">
						<div class="flex12child">
							<paper-input class="paperi" id="note" label="Commentaire" floatingLabel></paper-input>
							<p id="nerr" class="msgError" hidden>note requise</p>
						</div>
					</div>
					<div id="lastinfo">
						<div class="container">
							<paper-item class="paper" id="lastpoids" class="flex5child">Poids lors du dernier suivi : <span>{{lastNote.weight}}</span></paper-item>
							<div class="flex2child"></div>
							<paper-item class="paper" id="lasttaille" class="flex5child">Taille lors du dernier suivi : <span>{{lastNote.height}}</span></paper-item>
						</div>
						<div class="container">
							<paper-textarea id="textcontent">
						    <textarea id="lastnote" style="text-align:center;overflow-x: hidden;" on-click="fullScreen" readonly>{{lastNote.note}}</textarea>
							</paper-textarea>
						</div>
					</div>
					<div class="container centered">
						<paper-button id="sendSuivi" class="suiviButton" on-click="save">Sauvegarder</paper-button>
					</div>
				</div>
			</div>
		</paper-dialog>

	</template>

    <script>
		Polymer({ is:'suivi-element',
			properties: {
				lastNote: Object
			},
			ready: function() {
				this.$.content.addEventListener('keypress', function(e) {
    				if (e.keyCode == 13)
    					this.save();
	  			}.bind(this));
  			},
			toggleSuivi: function() {
				this.$.suivi.toggle();
			},
			clearInput: function() {
				this.$.poids.value = "";
				this.$.taille.value = "";
				this.$.note.value = "";
			},
			firstSave: function() {
				var a = 0;
				if (this.$.poids.value == "") {
					this.$.perr.hidden = false;
					a++
				}
				if (this.$.taille.value == "") {
					this.$.terr.hidden = false;
					a++
				}
				if (this.$.note.value == "") {
					this.$.nerr.hidden = false;
					a++
				}
				if (a == 0)
					this.fire("save-suivi", {
						"patientId": app.patientId,
						"poids": this.$.poids.value,
						"taille": this.$.taille.value,
						"note": this.$.note.value
					});
			},
			save: function() {
				this.$.perr.hidden = true;
				this.$.terr.hidden = true;
				this.$.nerr.hidden = true;
				if (this.$.poids.value == "" || +this.$.poids.value < 0)
					this.$.perr.hidden = false;
				else if (!this.lastNote)
					this.firstSave();
				else {
					var taille = this.$.taille.value || this.lastNote.height;
					this.fire("save-suivi", {
						"patientId": app.patientId,
						"poids": this.$.poids.value,
						"taille": taille,
						"note": this.$.note.value
					});
				}
			},
			suiviSaved: function() {
				app.writeToast("Suivi sauvegardÃ©");
				this.toggleSuivi();
			}
		});
  	</script>
</dom-module>
